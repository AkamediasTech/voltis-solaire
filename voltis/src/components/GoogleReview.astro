---
/**
 * GoogleReview.astro - Component to display Google review rating
 */

export interface GoogleReviewConfig {
  companyName: string;
  rating: number; // e.g., 4.6
  reviewCount: number; // e.g., 39
  profileImage?: string;
}

interface Props {
  config: GoogleReviewConfig;
}

const { config } = Astro.props;

// Calculate full stars and partial star
const fullStars = Math.floor(config.rating);
const partialStar = config.rating % 1;
const hasPartialStar = partialStar > 0;
const emptyStars = 5 - fullStars - (hasPartialStar ? 1 : 0);
---

<div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
  <!-- Profile Image -->
  {config.profileImage && (
    <img 
      src={config.profileImage} 
      alt={`${config.companyName} logo`}
      class="w-14 h-14 rounded-full object-cover border-2 border-white shadow-sm"
      loading="lazy"
    />
  )}
  
  <!-- Review Content -->
  <div class="flex-1">
    <!-- Company Name -->
    <h3 class="font-bold text-gray-900 text-base mb-1">{config.companyName}</h3>
    
    <!-- Rating and Stars -->
    <div class="flex items-center gap-2 mb-1">
      <span class="text-2xl font-bold text-gray-900">{config.rating.toFixed(1)}</span>
      
      <!-- Stars Container -->
      <div class="flex items-center gap-0.5" role="img" aria-label={`${config.rating} étoiles`}>
        {/* Full Stars */}
        {Array.from({ length: fullStars }).map(() => (
          <svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        ))}
        
        {/* Partial Star */}
        {hasPartialStar && (
          <div class="relative w-4 h-4">
            {/* Empty star background */}
            <svg class="absolute inset-0 w-4 h-4 text-gray-300 fill-current" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            {/* Filled portion */}
            <svg 
              class="absolute inset-0 w-4 h-4 text-yellow-400 fill-current overflow-hidden" 
              viewBox="0 0 24 24"
              style={`clip-path: inset(0 ${(1 - partialStar) * 100}% 0 0);`}
            >
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
        )}
        
        {/* Empty Stars */}
        {Array.from({ length: emptyStars }).map(() => (
          <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        ))}
      </div>
    </div>
    
    <!-- Review Count -->
    <p class="text-xs text-gray-600 mb-1">Basé sur {config.reviewCount} avis</p>
    
    <!-- Powered by Google -->
    <p class="text-xs text-gray-500">
      powered by 
      <span class="font-medium ml-1">
        <span style="color:#4285f4">G</span><span style="color:#ea4335">o</span><span style="color:#fbbc05">o</span><span style="color:#4285f4">g</span><span style="color:#34a853">l</span><span style="color:#ea4335">e</span>
      </span>
    </p>
  </div>
</div>
