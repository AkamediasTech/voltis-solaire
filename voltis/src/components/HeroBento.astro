---
/**
 * HeroBento.astro - Bento grid hero section with form
 * Fully configurable via props or site config
 */
import { getConfig } from '../config';
import Simulator from './Simulator';

// Types defined locally in component
export interface HeroBentoFeature {
  icon: 'flame' | 'snowflake' | 'sun' | 'zap';
  title: string;
  subtitle: string;
}

export interface HeroBentoPartnerLogo {
  src: string;
  alt: string;
}

export interface HeroBentoConfig {
  badge: string;
  headline: string;
  description: string;
  formBadge: string;
  formTitle: string;
  formSubtitle: string;
  productImage: string;
  productImageAlt: string;
  productBadge?: string;
  features: HeroBentoFeature[];
  partnerLogos?: HeroBentoPartnerLogo[];
}

interface Props {
  config?: HeroBentoConfig;
}

const { config: propConfig } = Astro.props;
const siteConfig = getConfig();
const heroBento = propConfig || (siteConfig?.content.heroBento as HeroBentoConfig | undefined);

if (!heroBento) {
  throw new Error('HeroBento: No configuration provided. Pass config prop or define content.heroBento in site config.');
}

// Icon components as functions
const icons: Record<HeroBentoFeature['icon'], string> = {
  flame: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>`,
  snowflake: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></svg>`,
  sun: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,
  zap: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
};
---

<section class="bg-gray-100 min-h-[850px] p-4 lg:p-6 flex items-center justify-center">
  <div class="max-w-[1400px] w-full mx-auto grid grid-cols-1 lg:grid-cols-12 gap-4 h-full">
    
    <!-- Box 1: Headline (Top Left, spans 7 cols) -->
    <div class="lg:col-span-7 bg-edf-blue rounded-3xl p-8 lg:p-12 text-white relative overflow-hidden flex flex-col justify-between min-h-[300px]">
      <div class="relative z-10">
        <div class="inline-flex items-center gap-2 border border-white/20 rounded-full px-3 py-1 text-sm mb-6">
          <span class="w-2 h-2 bg-edf-orange rounded-full"></span>
          {heroBento.badge}
        </div>
        <h1 class="text-4xl lg:text-6xl font-bold leading-tight" set:html={heroBento.headline}></h1>
      </div>
      
      <div class="relative z-10 mt-8 max-w-md">
        <p class="text-blue-100 text-lg">
          {heroBento.description}
        </p>
      </div>

      <!-- Abstract Decor -->
      <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-edf-orange to-transparent opacity-20 rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2"></div>
    </div>

    <!-- Box 2: Form (Right, spans 5 cols, full height on desktop) -->
    <div class="lg:col-span-5 lg:row-span-2 bg-white rounded-3xl p-8 shadow-lg border border-gray-200 flex flex-col justify-center" id="simulator">
      <div class="mb-6">
        <span class="text-xs font-bold tracking-widest text-edf-orange uppercase">{heroBento.formBadge}</span>
        <h2 class="text-3xl font-bold text-gray-900 mt-2">{heroBento.formTitle}</h2>
        <p class="text-gray-500 mt-2">{heroBento.formSubtitle}</p>
      </div>
      
      <Simulator client:idle webhookUrl={siteConfig.api.webhookUrl} />
      
      {heroBento.partnerLogos && heroBento.partnerLogos.length > 0 && (
        <div class="mt-6 flex items-center justify-center gap-4 grayscale opacity-50">
          {heroBento.partnerLogos.map((logo) => (
            <img src={logo.src} alt={logo.alt} class="h-8 w-auto object-contain" />
          ))}
        </div>
      )}
    </div>

    <!-- Box 3: Product Visual (Bottom Left, spans 4 cols) -->
    <div class="lg:col-span-4 bg-white rounded-3xl p-6 border border-gray-200 relative overflow-hidden flex items-center justify-center min-h-[300px] group">
      <div class="absolute inset-0 bg-gray-50 transition-colors group-hover:bg-blue-50"></div>
      <img 
        src={heroBento.productImage}
        alt={heroBento.productImageAlt}
        class="relative z-10 w-full max-w-[200px] object-contain drop-shadow-xl transform group-hover:scale-110 transition-transform duration-500"
        loading="eager"
      />
      {heroBento.productBadge && (
        <div class="absolute top-4 right-4 bg-edf-orange text-white text-xs font-bold px-2 py-1 rounded">
          {heroBento.productBadge}
        </div>
      )}
    </div>

    <!-- Box 4: Stats/Features (Bottom Middle, spans 3 cols) -->
    <div class="lg:col-span-3 bg-edf-orange rounded-3xl p-6 text-white flex flex-col justify-center relative overflow-hidden group">
      <div class="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      
      <div class="space-y-6 relative z-10">
        {heroBento.features.map((feature, index) => (
          <>
            {index > 0 && <div class="w-full h-px bg-white/20"></div>}
            <div class="flex items-center gap-3">
              <div class="bg-white/20 p-2 rounded-lg">
                <Fragment set:html={icons[feature.icon]} />
              </div>
              <div>
                <p class="font-bold text-xl">{feature.title}</p>
                <p class="text-sm opacity-80">{feature.subtitle}</p>
              </div>
            </div>
          </>
        ))}
      </div>
      
      <!-- Arrow decoration -->
      <div class="absolute bottom-4 right-4">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-50">
          <line x1="7" y1="17" x2="17" y2="7"/>
          <polyline points="7 7 17 7 17 17"/>
        </svg>
      </div>
    </div>

  </div>
</section>
