---
// ProductSection.astro - Composant généralisé
import { getConfig } from '@config';
import AnyWeatherColorIcon2 from './icons/AnyWeatherColorIcon2.astro';
import SunColorIcon from './icons/SunColorIcon.astro';
import SPBatteryChargeColorIcon from './icons/SPBatteryChargeColorIcon.astro';
import LinkColorIcon from './icons/LinkColorIcon';
import SnowflakeColorIcon from './icons/SnowflakeColorIcon';

interface ProductFeature {
  icon: 'weather' | 'sun' | 'battery' | 'link' | 'snowflake';
  title: string;
  description: string;
}

interface ProductConfig {
  badge?: string;
  mainTitle: string;
  highlightText: string;
  description: string[];
  ctaText: string;
  image: string;
  imageAlt: string;
  features: ProductFeature[];
}

interface Props {
  product?: ProductConfig;
}

const { product: propProduct } = Astro.props;
const config = !propProduct ? getConfig() : null;
const productContent = propProduct || config?.content.product;

// Hardcoded fallback
const HARDCODED_PRODUCT: ProductConfig = {
  badge: "Notre technologie",
  mainTitle: "Montez en puissance et",
  highlightText: "optimisez vos économies",
  description: [
    "Groupe France Solaire vous équipe de panneaux photovoltaïques nouvelle génération, à la pointe de l'innovation.",
    "Reprenez la main sur votre facture d'électricité et réalisez jusqu'à 60 % d'économies d'énergie par an<sup>(1)</sup>. Produisez et consommez votre propre énergie, toute l'année.",
    "Avec nos nouveaux panneaux solaires 500Wc, vous générez davantage d'électricité verte à surface équivalente. Leur technologie avancée garantit de meilleures performances, y compris lorsque l'ensoleillement est faible."
  ],
  ctaText: "Réaliser mon bilan solaire gratuit",
  image: "https://images.unsplash.com/photo-1613665813446-82a78c468a1d?q=80&w=800&auto=format&fit=crop",
  imageAlt: "Panneaux solaires",
  features: [
    {
      icon: 'weather',
      title: "Une production optimisée, quelle que soit la météo.",
      description: "Même sous un ciel couvert, en automne ou en hiver, nos panneaux captent davantage d'énergie. Vous produisez ainsi votre propre électricité plus régulièrement, tout au long de l'année."
    },
    {
      icon: 'sun',
      title: "Une production stable, même en été",
      description: "Grâce à une meilleure tolérance à la chaleur, notre technologie assure un rendement plus régulier que les solutions traditionnelles."
    },
    {
      icon: 'battery',
      title: "Durables par conception, rassurants au quotidien",
      description: "Des panneaux conçus pour durer, une performance au rendez-vous, et une garantie à vie<sup>(2)</sup> pour plus de sérénité."
    }
  ]
};

const product = productContent || HARDCODED_PRODUCT;
---

<section class="py-20 bg-white" id="Products">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Badge + Main Title -->
    <div class="text-center mb-16">
      {product.badge && (
        <div class="inline-flex items-center gap-2 bg-edf-orange/10 backdrop-blur-sm px-4 py-2 rounded-full border border-edf-orange/20 mb-6">
          <span class="text-edf-orange text-sm font-semibold">{product.badge}</span>
        </div>
      )}
      
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900">
        {product.mainTitle} <br><span class="text-edf-blue">{product.highlightText}</span>
      </h2>
    </div>

    <!-- Top Content: Text + Image -->
    <div class="flex flex-col lg:flex-row items-center gap-16 mb-20">
      
      <!-- Text Side -->
      <div class="lg:w-1/2 space-y-8 text-center lg:text-left">
        <h3 class="text-xl md:text-2xl font-bold text-edf-orange leading-tight">
          {product.description[0]}
        </h3>
        
        {product.description.slice(1).map((paragraph: string) => (
          <p class="text-gray-800 leading-relaxed text-base 3xl:text-lg" set:html={paragraph}></p>
        ))}

        <div class="pt-4 flex justify-center lg:justify-start">
          <button data-scroll-top class="hover:cursor-pointer bg-edf-orange text-white font-bold py-3.5 px-8 rounded-full hover:bg-edf-orangeHover transition-colors shadow-lg shadow-orange-100">
            {product.ctaText}
          </button>
        </div>
      </div>

      <!-- Image Side -->
      <div class="lg:w-1/2 flex justify-center w-full">
        <img 
          src={product.image} 
          alt={product.imageAlt} 
          class="w-full max-w-md object-contain drop-shadow-2xl rounded-xl"
          loading="lazy"
          width="800"
          height="600"
        />
      </div>
    </div>

    <!-- Features Columns -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
      {product.features.map((feature: ProductFeature) => (
        <div class="flex flex-col items-center text-center group">
          <div class="mb-6 transform transition-transform group-hover:scale-110 duration-300">
            {feature.icon === 'weather' && <AnyWeatherColorIcon2 class="w-16 h-16" />}
            {feature.icon === 'sun' && <SunColorIcon class="w-16 h-16" />}
            {feature.icon === 'battery' && <SPBatteryChargeColorIcon class="w-16 h-16" />}
            {feature.icon === 'link' && <LinkColorIcon size={64} />}
            {feature.icon === 'snowflake' && <SnowflakeColorIcon size={64} />}
          </div>
          <h4 class="text-lg font-bold text-gray-900 mb-4 h-auto md:h-14 flex items-center justify-center">
            {feature.title}
          </h4>
          <p class="text-sm text-justify text-gray-600 leading-relaxed max-w-xs mx-auto" set:html={feature.description}></p>
        </div>
      ))}
    </div>

    <!-- Bottom CTA -->
    <div class="mt-20 text-center">
      <button data-scroll-top class="cursor-pointer bg-edf-orange text-white font-bold py-3.5 px-8 rounded-full hover:bg-edf-orangeHover transition-colors shadow-lg shadow-orange-100">
        {product.ctaText}
      </button>
    </div>

  </div>
</section>
